/*!
 * (C) Ionic http://ionicframework.com - MIT License
 * Built with http://stenciljs.com
 */
const{h:t}=window.Ionic;class s{constructor(t,s,e){this.dirty=!1,this.isPan=0;const i=e*(Math.PI/180);this.isDirX="x"===t,this.maxCosine=Math.cos(i),this.threshold=s*s}start(t,s){this.startX=t,this.startY=s,this.isPan=0,this.dirty=!0}detect(t,s){if(!this.dirty)return!1;const e=t-this.startX,i=s-this.startY,r=e*e+i*i;if(r<this.threshold)return!1;const h=Math.sqrt(r),o=(this.isDirX?e:i)/h;return o>this.maxCosine?this.isPan=1:o<-this.maxCosine?this.isPan=-1:this.isPan=0,this.dirty=!1,!0}isGesture(){return 0!==this.isPan}getDirection(){return this.isPan}}class e{constructor(t,s,e,i,r){this.id=s,this.name=e,this.priority=i,this.disableScroll=r,this.ctrl=t}canStart(){return!!this.ctrl&&this.ctrl.canStart(this.name)}start(){return!!this.ctrl&&this.ctrl.start(this.name,this.id,this.priority)}capture(){if(!this.ctrl)return!1;const t=this.ctrl.capture(this.name,this.id,this.priority);return t&&this.disableScroll&&this.ctrl.disableScroll(this.id),t}release(){this.ctrl&&(this.ctrl.release(this.id),this.disableScroll&&this.ctrl.enableScroll(this.id))}destroy(){this.release(),this.ctrl=void 0}}class i{constructor(t,s,e,i){this.id=t,this.disable=e,this.disableScroll=i,this.ctrl=s}block(){if(this.ctrl){if(this.disable)for(const t of this.disable)this.ctrl.disableGesture(t,this.id);this.disableScroll&&this.ctrl.disableScroll(this.id)}}unblock(){if(this.ctrl){if(this.disable)for(const t of this.disable)this.ctrl.enableGesture(t,this.id);this.disableScroll&&this.ctrl.enableScroll(this.id)}}destroy(){this.unblock(),this.ctrl=void 0}}const r=new class{constructor(t){this.doc=t,this.gestureId=0,this.requestedStart=new Map,this.disabledGestures=new Map,this.disabledScroll=new Set,this.capturedId=null}createGesture(t){return new e(this,this.newID(),t.name,t.priority?t.priority:0,!!t.disableScroll)}createBlocker(t={}){return new i(this.newID(),this,t.disable,!!t.disableScroll)}start(t,s,e){return this.canStart(t)?(this.requestedStart.set(s,e),!0):(this.requestedStart.delete(s),!1)}capture(t,s,e){if(!this.start(t,s,e))return!1;const i=this.requestedStart;let r=-1e4;if(i.forEach(t=>{r=Math.max(r,t)}),r===e){this.capturedId=s,i.clear();const e=new CustomEvent("ionGestureCaptured",{detail:t});return this.doc.body.dispatchEvent(e),!0}return i.delete(s),!1}release(t){this.requestedStart.delete(t),this.capturedId&&t===this.capturedId&&(this.capturedId=null)}disableGesture(t,s){let e=this.disabledGestures.get(t);e||(e=new Set,this.disabledGestures.set(t,e)),e.add(s)}enableGesture(t,s){const e=this.disabledGestures.get(t);e&&e.delete(s)}disableScroll(t){this.disabledScroll.add(t)}enableScroll(t){this.disabledScroll.delete(t)}canStart(t){return!this.capturedId&&!this.isDisabled(t)}isCaptured(){return!!this.capturedId}isScrollDisabled(){return this.disabledScroll.size>0}isDisabled(t){const s=this.disabledGestures.get(t);return!!(s&&s.size>0)}newID(){return this.gestureId++,this.gestureId}}(document);let h;function o(t,s,e,i){const r=function(t){if(void 0===h)try{const s=Object.defineProperty({},"passive",{get:()=>{h=!0}});t.addEventListener("optsTest",()=>{},s)}catch(t){h=!1}return!!h}(t)?{capture:!!i.capture,passive:!!i.passive}:!!i.capture;let o,n;return t.__zone_symbol__addEventListener?(o="__zone_symbol__addEventListener",n="__zone_symbol__removeEventListener"):(o="addEventListener",n="removeEventListener"),t[o](s,e,r),()=>{t[n](s,e,r)}}const n=2e3;class a{constructor(t,s,e,i,r){this.el=t,this.pointerDown=s,this.pointerMove=e,this.pointerUp=i,this.options=r,this.lastTouchEvent=0,this.bindTouchEnd=this.handleTouchEnd.bind(this),this.bindMouseUp=this.handleMouseUp.bind(this)}set disabled(t){t?(this.rmTouchStart&&this.rmTouchStart(),this.rmMouseStart&&this.rmMouseStart(),this.rmTouchStart=this.rmMouseStart=void 0,this.stop()):(this.rmTouchStart||(this.rmTouchStart=o(this.el,"touchstart",this.handleTouchStart.bind(this),this.options)),this.rmMouseStart||(this.rmMouseStart=o(this.el,"mousedown",this.handleMouseDown.bind(this),this.options)))}stop(){this.stopTouch(),this.stopMouse()}destroy(){this.disabled=!0,this.pointerUp=this.pointerMove=this.pointerDown=void 0}handleTouchStart(t){this.lastTouchEvent=Date.now()+n,this.pointerDown(t,l)&&(!this.rmTouchMove&&this.pointerMove&&(this.rmTouchMove=o(this.el,"touchmove",this.pointerMove,this.options)),this.rmTouchEnd||(this.rmTouchEnd=o(this.el,"touchend",this.bindTouchEnd,this.options)),this.rmTouchCancel||(this.rmTouchCancel=o(this.el,"touchcancel",this.bindTouchEnd,this.options)))}handleMouseDown(t){this.lastTouchEvent>Date.now()||this.pointerDown(t,c)&&(!this.rmMouseMove&&this.pointerMove&&(this.rmMouseMove=o(d(this.el),"mousemove",this.pointerMove,this.options)),this.rmMouseUp||(this.rmMouseUp=o(d(this.el),"mouseup",this.bindMouseUp,this.options)))}handleTouchEnd(t){this.stopTouch(),this.pointerUp&&this.pointerUp(t,l)}handleMouseUp(t){this.stopMouse(),this.pointerUp&&this.pointerUp(t,c)}stopTouch(){this.rmTouchMove&&this.rmTouchMove(),this.rmTouchEnd&&this.rmTouchEnd(),this.rmTouchCancel&&this.rmTouchCancel(),this.rmTouchMove=this.rmTouchEnd=this.rmTouchCancel=void 0}stopMouse(){this.rmMouseMove&&this.rmMouseMove(),this.rmMouseUp&&this.rmMouseUp(),this.rmMouseMove=this.rmMouseUp=void 0}}function d(t){return t instanceof Document?t:t.ownerDocument}const c=1,l=2;function u(t){return new p(t)}class p{constructor(t){this.positions=[],this.hasCapturedPan=!1,this.hasStartedPan=!1,this.hasFiredStart=!0,this.isMoveQueued=!1;const e=Object.assign({disableScroll:!1,direction:"x",gesturePriority:0,passive:!0,maxAngle:40,threshold:10},t);this.canStart=e.canStart,this.onWillStart=e.onWillStart,this.onStart=e.onStart,this.onEnd=e.onEnd,this.onMove=e.onMove,this.threshold=e.threshold,this.queue=e.queue,this.detail={type:"pan",startX:0,startY:0,startTimeStamp:0,currentX:0,currentY:0,velocityX:0,velocityY:0,deltaX:0,deltaY:0,timeStamp:0,event:void 0,data:void 0},this.pointerEvents=new a(e.el,this.pointerDown.bind(this),this.pointerMove.bind(this),this.pointerUp.bind(this),{capture:!1}),this.pan=new s(e.direction,e.threshold,e.maxAngle),this.gesture=r.createGesture({name:t.gestureName,priority:t.gesturePriority,disableScroll:t.disableScroll})}set disabled(t){this.pointerEvents.disabled=t}destroy(){this.gesture.destroy(),this.pointerEvents.destroy()}pointerDown(t){const s=m(t);if(this.hasStartedPan||!this.hasFiredStart)return!1;const e=this.detail;return S(t,e),e.startX=e.currentX,e.startY=e.currentY,e.startTimeStamp=e.timeStamp=s,e.velocityX=e.velocityY=e.deltaX=e.deltaY=0,e.event=t,this.positions.length=0,(!this.canStart||!1!==this.canStart(e))&&(this.gesture.release(),!!this.gesture.start()&&(this.positions.push(e.currentX,e.currentY,s),this.hasStartedPan=!0,0===this.threshold?this.tryToCapturePan():(this.pan.start(e.startX,e.startY),!0)))}pointerMove(t){if(this.hasCapturedPan)return void(!this.isMoveQueued&&this.hasFiredStart&&(this.isMoveQueued=!0,this.calcGestureData(t),this.queue.write(this.fireOnMove.bind(this))));const s=this.detail;this.calcGestureData(t),this.pan.detect(s.currentX,s.currentY)&&this.pan.isGesture()&&(this.tryToCapturePan()||this.abortGesture())}fireOnMove(){if(!this.hasCapturedPan)return;const t=this.detail;this.isMoveQueued=!1,this.onMove&&this.onMove(t)}calcGestureData(t){const s=this.detail;S(t,s);const e=s.currentX,i=s.currentY,r=s.timeStamp=m(t);s.deltaX=e-s.startX,s.deltaY=i-s.startY,s.event=t;const h=r-100,o=this.positions;let n=o.length-1;for(;n>0&&o[n]>h;)n-=3;if(n>1){const t=1/(o[n]-r),h=o[n-1]-i,a=o[n-2]-e;s.velocityX=a*t,s.velocityY=h*t}else s.velocityX=0,s.velocityY=0;o.push(e,i,r)}tryToCapturePan(){if(this.gesture&&!this.gesture.capture())return!1;this.hasCapturedPan=!0,this.hasFiredStart=!1;const t=this.detail;return t.startX=t.currentX,t.startY=t.currentY,t.startTimeStamp=t.timeStamp,this.onWillStart?this.onWillStart(this.detail).then(this.fireOnStart.bind(this)):this.fireOnStart(),!0}fireOnStart(){this.onStart&&this.onStart(this.detail),this.hasFiredStart=!0}abortGesture(){this.reset(),this.pointerEvents.stop(),this.notCaptured&&this.notCaptured(this.detail)}reset(){this.hasCapturedPan=!1,this.hasStartedPan=!1,this.isMoveQueued=!1,this.hasFiredStart=!0,this.gesture&&this.gesture.release()}pointerUp(t){const s=this.hasCapturedPan,e=this.hasFiredStart;if(this.reset(),!e)return;this.calcGestureData(t);const i=this.detail;s?this.onEnd&&this.onEnd(i):this.notCaptured&&this.notCaptured(i)}}function S(t,s){let e=0,i=0;if(t){const s=t.changedTouches;if(s&&s.length>0){const t=s[0];e=t.clientX,i=t.clientY}else void 0!==t.pageX&&(e=t.pageX,i=t.pageY)}s.currentX=e,s.currentY=i}function m(t){return t.timeStamp||Date.now()}export{u as create,p as Gesture};